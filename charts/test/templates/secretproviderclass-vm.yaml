apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: azure-sync-vm
spec:
  {{- $accountKey :=.Values.fileshare.keyVault.accountKey }}
  {{- $accountName :=.Values.fileshare.keyVault.accountName }}
  provider: azure 
  vmIdentity: "true"
  keyVault: {{ .Values.fileshare.keyVault.vaultName | quote}}
  objects: |
    array:
      - |
        objectName: {{ $accountName }}
        objectType: secret
      - |
        objectName: {{ $accountKey }}
        objectType: secret                     
  secretObjects:
    - data:
      - key: azurestorageaccountname
        objectName: {{ $accountName | quote}}
      - key: azurestorageaccountkey
        objectName: {{ $accountKey | quote }}
      secretName: {{ .Values.fileshare.vmSecretName | quote }}
      type: Opaque