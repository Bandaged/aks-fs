apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: azure-sync-pod-id
spec:
  provider: azure 
  {{- if .Values.podIdentity.workloadIdentity }}
  clientId: 
  {{else}}
  podIdenity: "true"
  {{-end}}
  tenantId: {{.Values.keyVault.tenantId}}
  keyVault: {{ .Values.keyVault.vaultName | quote}}
  objects: |
    array:
      - |
        objectName: {{ .Values.keyVault.accountName }}
        objectType: secret
        objectAlias: azurestorageaccountname
      - |
        objectName: {{ .Values.keyVault.accountKey }}
        objectType: secret    
        objectAlias: azurestorageaccountkey             
  secretObjects:
    - data:
      - key: azurestorageaccountname
        objectName: azurestorageaccountname
      - key: azurestorageaccountkey
        objectName: azurestorageaccountkey
      secretName: {{ .Values.fileshare.podIdSecretName | required ".Values.fileshare.podIdSecretName" | quote }}
      type: Opaque